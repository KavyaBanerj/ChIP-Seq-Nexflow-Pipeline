// nextflow.config

// Enable Docker integration
docker.enabled = true

// -----------------------------
//  Define Global Parameters
// -----------------------------

params {
    // Maximum resource allocations (can be overridden per process)
    max_memory = '64 GB'
    max_cpus   = 16
    max_time   = '48h'

    // Input and output configurations
    reads          = "$PWD/data/reads/*{1,2}.fastq.gz"        // Path to raw FASTQ files
    outdir         = "$PWD/results"                           // Output directory
    genome         = "$PWD/data/refGenome/mm10.fa"            // Path to mouse genome FASTA file
    gtf            = "$PWD/data/refGenome/mm10.gtf"           // Path to GTF file (optional for ChIP-seq)
    blacklist_url  = "https://raw.githubusercontent.com/Boyle-Lab/Blacklist/master/lists/mm10-blacklist.v2.bed.gz" // URL to mouse blacklist file
    blacklist_path = "$PWD/resources/blacklist/mm10-blacklist.v2.bed" // Local path to blacklist file
    adapters       = "$PWD/resources/adapters.fa"            // Path to adapter sequences
    genome_size    = "mm"                                    // Genome size for MACS2 (mm for mouse)
    bowtie2_threads = 4                                      // Number of threads for Bowtie2
    bowtie2_index   = "$PWD/results/bowtie2_index"         // Bowtie2 index directory
    skip_alignment  = false                                  // Option to skip alignment (if needed)
    test_mode       = false                                  // Enable test mode
}

// -----------------------------
//  Define Process Resource Allocations and Docker Containers
// -----------------------------

process {
    withName:DownloadBlacklist {
        cpus    = 2
        memory  = '4 GB'
        time    = '1h'
        container = 'biocontainers/wget:1.21.3--hda2e75f_0'
    }
    withName:FastQC {
        cpus    = 2
        memory  = '4 GB'
        time    = '2h'
        container = 'quay.io/biocontainers/fastqc:0.12.1--hdfd78af_0'
    }
    withName:TrimGalore {
        cpus    = 2
        memory  = '8 GB'
        time    = '4h'
        container = 'quay.io/biocontainers/trim-galore:0.6.6--hdfd78af_1'
    }
    withName:Bowtie2Index {
        cpus    = 4
        memory  = '16 GB'
        time    = '12h'
        container = 'biocontainers/bowtie2:2.4.5--hdfd78af_0'
    }
    withName:Bowtie2Align {
        cpus    = 8
        memory  = '32 GB'
        time    = '24h'
        container = 'biocontainers/bowtie2:2.4.5--hdfd78af_0'
    }
    withName:PostAlignChIPseq {
        cpus    = 4
        memory  = '16 GB'
        time    = '12h'
        container = 'biocontainers/samtools:1.15--hdfd78af_0'
    }
    withName:PeakCalling {
        cpus    = 4
        memory  = '16 GB'
        time    = '12h'
        container = 'biocontainers/macs2:2.2.7.1--pyhdfd78af_0'
    }
    withName:FilterBlacklistedPeaks {
        cpus    = 2
        memory  = '8 GB'
        time    = '4h'
        container = 'biocontainers/bedtools:2.30.0--hdfd78af_0'
    }
    withName:AnnotatePeaks {
        cpus    = 2
        memory  = '8 GB'
        time    = '4h'
        container = 'biocontainers/r-base:4.1.0--hdfd78af_0'
    }
    withName:MultiQC {
        cpus    = 2
        memory  = '4 GB'
        time    = '1h'
        container = 'quay.io/biocontainers/multiqc:1.11--pyhdfd78af_0'
    }
    withName:TestProcess {
        cpus    = 1
        memory  = '2 GB'
        time    = '30m'
        container = 'biocontainers/alpine:3.15--h8ed1ab2_0' // Example container
    }
}

// -----------------------------
// 4. Define Profiles
// -----------------------------

profiles {
    standard {
        // No additional configuration needed if containers are specified per process
    }

    test {
        params {
            reads          = "$PWD/test_data/reads/*{1,2}.fastq.gz"
            outdir         = "$PWD/test_results"
            genome         = "$PWD/test_data/refGenome/test_mm10.fa"
            gtf            = "$PWD/test_data/refGenome/test_mm10.gtf"
            blacklist_url  = "https://raw.githubusercontent.com/Boyle-Lab/Blacklist/master/lists/mm10-blacklist.v2.bed.gz"
            blacklist_path = "$PWD/resources/blacklist/mm10-blacklist.v2.bed"
            adapters       = "$PWD/resources/adapters.fa"
            genome_size    = "mm"
            bowtie2_threads = 2
            bowtie2_index   = "$PWD/test_results/bowtie2_index"
            test_mode       = true
        }

        process {
            withName:DownloadBlacklist {
                cpus    = 1
                memory  = '2 GB'
                time    = '15m'
            }
            withName:FastQC {
                cpus    = 1
                memory  = '2 GB'
                time    = '30m'
            }
            withName:TrimGalore {
                cpus    = 1
                memory  = '4 GB'
                time    = '2h'
            }
            withName:Bowtie2Index {
                cpus    = 1
                memory  = '4 GB'
                time    = '30m'
            }
            withName:Bowtie2Align {
                cpus    = 2
                memory  = '8 GB'
                time    = '1h'
            }
            withName:PostAlignChIPseq {
                cpus    = 2
                memory  = '4 GB'
                time    = '1h'
            }
            withName:PeakCalling {
                cpus    = 2
                memory  = '8 GB'
                time    = '2h'
            }
            withName:FilterBlacklistedPeaks {
                cpus    = 1
                memory  = '4 GB'
                time    = '1h'
            }
            withName:AnnotatePeaks {
                cpus    = 1
                memory  = '4 GB'
                time    = '1h'
            }
            withName:MultiQC {
                cpus    = 1
                memory  = '2 GB'
                time    = '30m'
            }
            withName:TestProcess {
                cpus    = 1
                memory  = '1 GB'
                time    = '10m'
            }
        }
    }
}
